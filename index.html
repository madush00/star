<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Star Chat with Firebase</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }
        .auth-screen { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0a1929 0%, #1a3a52 50%, #0a1929 100%); position: relative; }
        .auth-screen::before { content: ''; position: absolute; width: 100%; height: 100%; background-image: url('data:image/svg+xml,%3Csvg width="80" height="80" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3Cpattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"%3E%3Cpath d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(0,200,255,0.15)" stroke-width="1"/%3E%3C/pattern%3E%3C/defs%3E%3Crect width="80" height="80" fill="url(%23grid)"/%3E%3C/svg%3E'); opacity: 0.5; }
        .auth-box { background: white; padding: 48px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 200, 255, 0.4); width: 90%; max-width: 450px; position: relative; z-index: 1; border: 2px solid rgba(0, 200, 255, 0.3); }
        .auth-logo { text-align: center; font-size: 64px; margin-bottom: 20px; }
        .auth-title { text-align: center; font-size: 36px; color: #0a1520; margin-bottom: 8px; font-weight: 700; }
        .auth-subtitle { text-align: center; color: #667781; font-size: 15px; margin-bottom: 32px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #111b21; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px; outline: none; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus { border-color: #00ccff; box-shadow: 0 0 0 3px rgba(0, 204, 255, 0.1); }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; display: none; }
        .alert.show { display: block; }
        .alert-error { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; }
        .alert-success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #2e7d32; }
        .btn-primary { width: 100%; padding: 16px; background: linear-gradient(135deg, #00ccff 0%, #0099cc 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 204, 255, 0.4); }
        .toggle-form { text-align: center; margin-top: 24px; color: #667781; font-size: 14px; }
        .toggle-link { color: #00ccff; cursor: pointer; font-weight: 700; }
        .toggle-link:hover { text-decoration: underline; }
        .app-container { display: flex; height: 100vh; background: #f0f2f5; }
        .sidebar { width: 380px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; }
        .sidebar-header { background: linear-gradient(135deg, #00ccff 0%, #0099cc 100%); padding: 20px; color: white; }
        .user-profile { display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
        .profile-avatar { width: 50px; height: 50px; border-radius: 50%; border: 3px solid white; }
        .profile-info h3 { font-size: 18px; font-weight: 700; margin-bottom: 2px; }
        .profile-info p { font-size: 13px; opacity: 0.9; }
        .sidebar-nav { display: flex; gap: 12px; }
        .nav-btn { flex: 1; padding: 10px; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .nav-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .nav-btn.active { background: white; color: #00ccff; }
        .search-bar { padding: 16px; background: #f0f2f5; border-bottom: 1px solid #e0e0e0; }
        .search-input { width: 100%; padding: 12px 16px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; outline: none; font-size: 14px; }
        .search-input:focus { border-color: #00ccff; }
        .chat-list { flex: 1; overflow-y: auto; }
        .chat-item { padding: 16px; display: flex; gap: 14px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: background 0.2s; }
        .chat-item:hover { background: #f5f6f6; }
        .chat-item.active { background: #e3f2fd; }
        .chat-avatar { position: relative; }
        .chat-avatar img { width: 54px; height: 54px; border-radius: 50%; }
        .online-badge { position: absolute; bottom: 0; right: 0; width: 14px; height: 14px; background: #25d366; border: 3px solid white; border-radius: 50%; }
        .chat-details { flex: 1; min-width: 0; }
        .chat-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .chat-name { font-weight: 700; font-size: 16px; color: #111b21; }
        .chat-time { font-size: 12px; color: #667781; }
        .chat-bottom { display: flex; justify-content: space-between; align-items: center; }
        .chat-message { font-size: 14px; color: #667781; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .welcome { flex: 1; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0a1929 0%, #1a3a52 100%); position: relative; }
        .welcome::before { content: ''; position: absolute; width: 100%; height: 100%; background-image: url('data:image/svg+xml,%3Csvg width="80" height="80" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3Cpattern id="grid2" width="40" height="40" patternUnits="userSpaceOnUse"%3E%3Cpath d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(0,200,255,0.15)" stroke-width="1"/%3E%3C/pattern%3E%3C/defs%3E%3Crect width="80" height="80" fill="url(%23grid2)"/%3E%3C/svg%3E'); opacity: 0.4; }
        .welcome-content { text-align: center; position: relative; z-index: 1; }
        .welcome-icon { font-size: 80px; margin-bottom: 24px; }
        .welcome-title { font-size: 42px; color: #00ccff; margin-bottom: 16px; font-weight: 700; }
        .welcome-text { color: #8bb4cc; font-size: 18px; max-width: 500px; }
        .chat-window { flex: 1; display: flex; flex-direction: column; background: white; }
        .chat-header { padding: 20px; background: #f0f2f5; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }
        .chat-header-left { display: flex; gap: 14px; align-items: center; }
        .chat-header-avatar { width: 48px; height: 48px; border-radius: 50%; }
        .chat-header-info h3 { font-size: 18px; font-weight: 700; color: #111b21; }
        .chat-header-info p { font-size: 14px; color: #667781; }
        .messages { flex: 1; overflow-y: auto; padding: 24px; background: #efeae2; }
        .message { display: flex; margin-bottom: 16px; }
        .message.sent { justify-content: flex-end; }
        .message-content { max-width: 65%; padding: 12px 16px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .message.received .message-content { background: white; border-bottom-left-radius: 4px; }
        .message.sent .message-content { background: #d9fdd3; border-bottom-right-radius: 4px; }
        .message-text { font-size: 15px; color: #111b21; line-height: 1.6; word-wrap: break-word; }
        .message-footer { font-size: 12px; color: #667781; margin-top: 8px; text-align: right; }
        .chat-input { padding: 20px; background: #f0f2f5; display: flex; gap: 12px; align-items: center; }
        .input-field { flex: 1; padding: 14px 18px; background: white; border: 2px solid #e0e0e0; border-radius: 10px; outline: none; font-size: 15px; }
        .input-field:focus { border-color: #00ccff; }
        .send-button { color: #00ccff; cursor: pointer; }
        .dashboard { flex: 1; overflow-y: auto; padding: 32px; background: #f5f6f7; }
        .dashboard-title { font-size: 36px; font-weight: 700; color: #111b21; margin-bottom: 32px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat { background: white; padding: 28px; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); border-left: 5px solid #00ccff; }
        .stat.green { border-left-color: #25d366; }
        .stat.orange { border-left-color: #ff9800; }
        .stat-label { font-size: 14px; color: #667781; font-weight: 600; margin-bottom: 12px; text-transform: uppercase; }
        .stat-value { font-size: 42px; font-weight: 700; color: #111b21; }
    </style>
</head>
<body>
    <div class="auth-screen" id="authScreen">
        <div class="auth-box">
            <div class="auth-logo">ðŸ’¬</div>
            <h1 class="auth-title">Global Star Chat</h1>
            <p class="auth-subtitle">Connect with people worldwide</p>
            <form id="loginForm">
                <div class="alert alert-error" id="loginError"></div>
                <div class="form-group"><label>Username</label><input type="text" id="loginUser" required></div>
                <div class="form-group"><label>Password</label><input type="password" id="loginPass" required></div>
                <button type="submit" class="btn-primary">Login</button>
                <div class="toggle-form">Don't have an account? <span class="toggle-link" onclick="toggleAuth()">Sign up</span></div>
            </form>
            <form id="signupForm" class="hidden">
                <div class="alert alert-error" id="signupError"></div>
                <div class="alert alert-success" id="signupSuccess"></div>
                <div class="form-group"><label>Username</label><input type="text" id="signupUser" required minlength="3"></div>
                <div class="form-group"><label>Password</label><input type="password" id="signupPass" required minlength="6"></div>
                <div class="form-group"><label>Confirm Password</label><input type="password" id="signupConfirm" required></div>
                <button type="submit" class="btn-primary">Sign Up</button>
                <div class="toggle-form">Already have an account? <span class="toggle-link" onclick="toggleAuth()">Login</span></div>
            </form>
        </div>
    </div>

    <div class="app-container hidden" id="appContainer">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <img src="" class="profile-avatar" id="profileAvatar">
                    <div class="profile-info">
                        <h3 id="profileName">User</h3>
                        <p id="profileRole">User</p>
                    </div>
                </div>
                <div class="sidebar-nav">
                    <button class="nav-btn active" onclick="showView('chat')"><i data-lucide="message-circle" style="width:16px;height:16px"></i> Chats</button>
                    <button class="nav-btn hidden" id="dashboardNavBtn" onclick="showView('dashboard')"><i data-lucide="layout-dashboard" style="width:16px;height:16px"></i> Dashboard</button>
                    <button class="nav-btn" onclick="logout()"><i data-lucide="log-out" style="width:16px;height:16px"></i> Logout</button>
                </div>
            </div>
            <div class="search-bar"><input type="text" class="search-input" placeholder="Search chats..."></div>
            <div class="chat-list" id="chatList"></div>
        </div>

        <div class="main-content">
            <div class="welcome" id="welcomeView">
                <div class="welcome-content">
                    <div class="welcome-icon">ðŸ’¬</div>
                    <h1 class="welcome-title">Global Star Chat</h1>
                    <p class="welcome-text">Connect with people around the world. Select a chat to start messaging.</p>
                </div>
            </div>

            <div class="chat-window hidden" id="chatView">
                <div class="chat-header">
                    <div class="chat-header-left">
                        <img src="" class="chat-header-avatar" id="chatHeaderAvatar">
                        <div class="chat-header-info">
                            <h3 id="chatHeaderName">Chat</h3>
                            <p id="chatHeaderStatus">online</p>
                        </div>
                    </div>
                </div>
                <div class="messages" id="messagesContainer"></div>
                <div class="chat-input">
                    <input type="text" class="input-field" id="messageInput" placeholder="Type a message...">
                    <i data-lucide="send" class="send-button" onclick="sendMessage()"></i>
                </div>
            </div>

            <div class="dashboard hidden" id="dashboardView">
                <h1 class="dashboard-title">Admin Dashboard</h1>
                <div class="stats">
                    <div class="stat"><div class="stat-label">Total Users</div><div class="stat-value" id="totalUsers">0</div></div>
                    <div class="stat green"><div class="stat-label">Online Users</div><div class="stat-value" id="onlineUsers">0</div></div>
                    <div class="stat orange"><div class="stat-label">Administrators</div><div class="stat-value" id="totalAdmins">0</div></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCCjPlbM_3tujVYtuUa2Ig_sVyS2wa4N1c",
            authDomain: "simple-chat-4f05c.firebaseapp.com",
            databaseURL: "https://simple-chat-4f05c-default-rtdb.firebaseio.com",
            projectId: "simple-chat-4f05c",
            storageBucket: "simple-chat-4f05c.firebasestorage.app",
            messagingSenderId: "788588013054",
            appId: "1:788588013054:web:c44fb4a22664963fee0caf"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let currentUser = null;
        let selectedChat = null;
        let users = {};
        let chats = {};

        window.toggleAuth = function() {
            document.getElementById('loginForm').classList.toggle('hidden');
            document.getElementById('signupForm').classList.toggle('hidden');
        };

        async function initializeDefaultData() {
            const usersRef = ref(db, 'users');
            const snapshot = await get(usersRef);
            if (!snapshot.exists()) {
                await set(ref(db, 'users/admin'), { username: 'admin', password: 'admin123', role: 'admin', online: false });
                await set(ref(db, 'users/john'), { username: 'john', password: 'john123', role: 'user', online: false });
                await set(ref(db, 'users/jane'), { username: 'jane', password: 'jane123', role: 'user', online: false });
            }
        }

        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPass').value;
            
            const snapshot = await get(ref(db, 'users'));
            const allUsers = snapshot.val() || {};
            const userKey = Object.keys(allUsers).find(k => allUsers[k].username === username && allUsers[k].password === password);
            
            if (userKey) {
                currentUser = { id: userKey, ...allUsers[userKey] };
                await update(ref(db, `users/${userKey}`), { online: true });
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                initApp();
            } else {
                showAlert('loginError', 'Invalid credentials');
            }
        };

        document.getElementById('signupForm').onsubmit = async (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUser').value.trim();
            const password = document.getElementById('signupPass').value;
            const confirm = document.getElementById('signupConfirm').value;

            if (password !== confirm) {
                showAlert('signupError', 'Passwords do not match');
                return;
            }

            const snapshot = await get(ref(db, 'users'));
            const allUsers = snapshot.val() || {};
            if (Object.values(allUsers).find(u => u.username === username)) {
                showAlert('signupError', 'Username already exists');
                return;
            }

            const newUserRef = push(ref(db, 'users'));
            await set(newUserRef, { username, password, role: 'user', online: false });
            showAlert('signupSuccess', 'Account created! Please login.');
            setTimeout(() => {
                toggleAuth();
                document.getElementById('loginUser').value = username;
            }, 2000);
        };

        window.logout = async function() {
            if (currentUser) {
                await update(ref(db, `users/${currentUser.id}`), { online: false });
            }
            currentUser = null;
            selectedChat = null;
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
        };

        function initApp() {
            document.getElementById('profileName').textContent = currentUser.username;
            document.getElementById('profileRole').textContent = currentUser.role === 'admin' ? 'Administrator' : 'User';
            document.getElementById('profileAvatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${currentUser.username}`;
            
            if (currentUser.role === 'admin') {
                document.getElementById('dashboardNavBtn').classList.remove('hidden');
            }

            onValue(ref(db, 'users'), (snapshot) => {
                users = snapshot.val() || {};
                renderChats();
                updateDashboard();
            });

            onValue(ref(db, 'chats'), (snapshot) => {
                chats = snapshot.val() || {};
                renderChats();
                if (selectedChat) {
                    renderMessages();
                }
            });
            
            showView('chat');
            lucide.createIcons();
        }

        window.showView = function(view) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (event?.target) event.target.classList.add('active');
            
            document.getElementById('welcomeView').classList.add('hidden');
            document.getElementById('chatView').classList.add('hidden');
            document.getElementById('dashboardView').classList.add('hidden');

            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
                updateDashboard();
            } else {
                if (selectedChat) {
                    document.getElementById('chatView').classList.remove('hidden');
                } else {
                    document.getElementById('welcomeView').classList.remove('hidden');
                }
            }
            lucide.createIcons();
        };

        function renderChats() {
            const list = document.getElementById('chatList');
            list.innerHTML = '';
            Object.entries(users).forEach(([id, user]) => {
                if (id === currentUser.id) return;
                const div = document.createElement('div');
                div.className = 'chat-item' + (selectedChat === id ? ' active' : '');
                div.onclick = () => selectChat(id, user);
                div.innerHTML = `
                    <div class="chat-avatar">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}">
                        ${user.online ? '<div class="online-badge"></div>' : ''}
                    </div>
                    <div class="chat-details">
                        <div class="chat-top">
                            <span class="chat-name">${user.username}</span>
                            <span class="chat-time"></span>
                        </div>
                        <div class="chat-bottom">
                            <span class="chat-message">Start chatting...</span>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function selectChat(userId, user) {
            selectedChat = userId;
            document.getElementById('welcomeView').classList.add('hidden');
            document.getElementById('chatView').classList.remove('hidden');
            document.getElementById('chatHeaderAvatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.username}`;
            document.getElementById('chatHeaderName').textContent = user.username;
            document.getElementById('chatHeaderStatus').textContent = user.online ? 'online' : 'offline';
            renderMessages();
            lucide.createIcons();
        }

        function renderMessages() {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            const chatKey = [currentUser.id, selectedChat].sort().join('_');
            const messages = chats[chatKey] || {};
            
            Object.values(messages).forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.from === currentUser.id ? 'sent' : 'received'}`;
                div.innerHTML = `
                    <div class="message-content">
                        <div class="message-text">${msg.text}</div>
                        <div class="message-footer">${msg.time}</div>
                    </div>
                `;
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        }

        window.sendMessage = async function() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text || !selectedChat) return;

            const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            const chatKey = [currentUser.id, selectedChat].sort().join('_');
            const messageRef = push(ref(db, `chats/${chatKey}`));
            await set(messageRef, { text, from: currentUser.id, time, timestamp: Date.now() });
            input.value = '';
        };

        document.getElementById('messageInput').onkeypress = (e) => {
            if (e.key === 'Enter') sendMessage();
        };

        function updateDashboard() {
            const userList = Object.values(users);
            document.getElementById('totalUsers').textContent = userList.length;
            document.getElementById('onlineUsers').textContent = userList.filter(u => u.online).length;
            document.getElementById('totalAdmins').textContent = userList.filter(u => u.role === 'admin').length;
        }

        function showAlert(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 5000);
        }

        initializeDefaultData();
        lucide.createIcons();
    </script>
</body>
</html>
